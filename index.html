<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚­ãƒã‚³ãƒ«ãƒ¼ãƒ—ç”Ÿæˆæ©Ÿ / Mushloop Generator</title>
    <style>
        body {
            font-family: 'Meiryo', 'ãƒ¡ã‚¤ãƒªã‚ª', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .warning {
            color: #d32f2f;
            text-align: center;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .version {
            color: #666;
            text-align: center;
            font-size: 0.9em;
            margin-top: 0;
            margin-bottom: 15px;
        }
        .credit {
            color: #666;
            text-align: center;
            font-size: 0.8em;
            margin-top: 5px;
            margin-bottom: 15px;
        }
        .container {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .input-section {
            margin-bottom: 20px;
        }
        .input-section label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .input-section input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .input-section select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .checkbox-section {
            margin-bottom: 15px;
        }
        .checkbox-section label {
            display: inline-flex;
            align-items: center;
            cursor: pointer;
        }
        .checkbox-section input {
            margin-right: 8px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
        }
        button:hover {
            background-color: #45a049;
        }
        #results {
            margin-top: 20px;
        }
        .result-item {
            background-color: #f9f9f9;
            border-left: 4px solid #4CAF50;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 4px;
        }
        .internal-values {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px dashed #ccc;
            font-size: 0.9em;
            color: #666;
        }
        #progress {
            width: 100%;
            background-color: #ddd;
            margin-top: 10px;
            display: none;
        }
        #progress-bar {
            width: 0%;
            height: 20px;
            background-color: #4CAF50;
            text-align: center;
            line-height: 20px;
            color: white;
        }
        .result-count {
            text-align: center;
            font-weight: bold;
            margin: 15px 0;
        }
        footer {
            margin-top: 30px;
            text-align: center;
            font-size: 0.9em;
            color: #666;
            padding: 10px;
        }
        footer a {
            color: #4CAF50;
            text-decoration: none;
        }
        details.explanation {
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
        }
        details.explanation summary {
            padding: 10px 15px;
            background-color: #f0f0f0;
            cursor: pointer;
            font-weight: bold;
        }
        details.explanation .explanation-content {
            padding: 15px;
            background-color: #fdfdfd;
            border-top: 1px solid #ddd;
        }
        details.explanation hr {
            margin: 15px 0;
            border: 0;
            border-top: 1px dashed #ccc;
        }
        .important {
            color: #d32f2f;
        }
    </style>
</head>
<body>
    <h1>ã‚­ãƒã‚³ãƒ«ãƒ¼ãƒ—ç”Ÿæˆæ©Ÿ / Mushloop Generator</h1>
    <p class="credit">Made by Claude(AI) with N / 5mm (X:@N_SMM2)</p>
    <div class="container">
        <p class="warning">å¥‡æ•°å‘¨æœŸã®ãƒ«ãƒ¼ãƒ—ã¯ç”Ÿæˆã§ãã¾ã›ã‚“ / Odd-period loops cannot be generated</p>
        <p class="version">Ver 1.7.1 Last Update: 2025/5/17</p>
        
        <details class="explanation">
            <summary>èª¬æ˜ / Explanation</summary>
            <div class="explanation-content">
                <p>ã‚­ãƒã‚³ãƒ«ãƒ¼ãƒ—ã®å‘¨æœŸã‹ã‚‰é…ç½®ã™ã¹ãåœ°å½¢ãƒ‘ãƒ¼ãƒ„ã®æ•°ã‚’æ±‚ã‚ã¦ãã‚Œã¾ã™ã€‚è¡¨ç¤ºã•ã‚Œã‚‹å€¤ã¯ãƒ«ãƒ¼ãƒ—ã®æ¨ªå¹…ã§ã¯ãªãå®Ÿå‹•è·é›¢ã§ã‚ã‚Šã€ä¸¡ç«¯0.5ãƒã‚¹åˆ†ã¯ã‚«ã‚¦ãƒ³ãƒˆã•ã‚Œã¦ã„ãªã„ã“ã¨ã«æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚</p>
                <p>çµæœã¯è¶³ã—ç®—ã®å½¢ã§è¡¨ç¤ºã•ã‚Œã€ãã®ã†ã¡å³å´ã®æ•°å­—ãŒç«¯ç‚¹éƒ¨ã®é•·ã•ã€å·¦å´ã®æ•°å­—ãŒä¸­é–“éƒ¨ã®é•·ã•ã«ç›¸å½“ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€[<strong>çµæœ 5</strong> åœ°é¢ (Ground): 58 + 0 æ€¥ãªå‚ (Steep Slope): 2 + 0.5 ç·©ã‚„ã‹ãªå‚ (Gentle Slope): 0 + 0.75]ã¨è¡¨ç¤ºã•ã‚ŒãŸå ´åˆã«ã¯ã€ä¸€æ–¹ã®ç«¯ã«0.75å€‹+0.5ãƒã‚¹=2ãƒã‚¹(1å€‹)ã®ç·©ã‚„ã‹ãªå‚ã€ä¸€æ–¹ã®ç«¯ã«0.5å€‹+0.5ãƒã‚¹=1ãƒã‚¹(1å€‹)ã®æ€¥ãªå‚ã€ãã®é–“ã«58å€‹ã®åœ°é¢ã‚’ç½®ãã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚</p>
                <p class="important">ã‚¢ã‚¹ã‚¿ãƒªã‚¹ã‚¯(*)ã®ã¤ã„ãŸã‚‚ã®ã¯æ—¢çŸ¥ã®æ–¹ç¨‹å¼ã«å½“ã¦ã¯ã¾ã‚‰ãªã„æŒ™å‹•ã‚’ç¤ºã™å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€ä½¿ã†ã®ã‚’ãŠã™ã™ã‚ã—ã¾ã›ã‚“ã€‚</p>
                <hr>
                <p>This tool calculates the number of terrain elements needed for a mushroom loop based on its period. The displayed values represent actual travel distance, not loop width, and it's important to note that the 0.5 tiles at both ends are not counted.</p>
                <p>The result is displayed as a sum, where the number on the right represents the length of the end section, and the number on the left corresponds to the length of the middle section. For example, if you see [<strong>Result 5</strong> Ground: 58 + 0 Steep Slope: 2 + 0.5 Gentle Slope: 0 + 0.75], it means you should place 0.75 pieces + 0.5 tiles = 2 tiles (1 piece) of gentle slope at one end, 0.5 pieces + 0.5 tiles = 1 tile (1 piece) of steep slope at the other end, and 58 ground tiles in between.</p>
                <p class="important">Results marked with an asterisk (*) may not follow known equations and are not recommended for use.</p>
    
            </div>
        </details>
        
        <div class="input-section">
            <label for="period">å‘¨æœŸ/Period[f]:</label>
            <input type="number" id="period" min="2" step="2" value="66">
        </div>
        
        <div class="input-section">
            <label for="displayCount">è¡¨ç¤ºã™ã‚‹çµæœã®æ•° (Results to display):</label>
            <input type="number" id="displayCount" min="1" value="5">
        </div>

        <div class="input-section">
            <label for="sortOrder">ä¸¦ã³æ›¿ãˆ (Sort Order):</label>
            <select id="sortOrder">
                <option value="1">åœ°é¢ã®å€¤ãŒå¤§ãã„é † (Ground value descending)</option>
                <option value="2">åœ°é¢ã®å€¤ãŒå°ã•ã„é † (Ground value ascending)</option>
            </select>
        </div>

        <div class="checkbox-section">
            <label for="filterForMusicBlock">
                <input type="checkbox" id="filterForMusicBlock">
                æ¥½å™¨ãƒ–ãƒ­ãƒƒã‚¯ã‚’ç¢ºå®Ÿã«é…ç½®ã§ãã‚‹ã‚‚ã®ã®ã¿ã«çµã‚‹ / Filter for music block placement
            </label>
        </div>

        <div class="checkbox-section">
            <label for="filterNoAsterisk">
                <input type="checkbox" id="filterNoAsterisk">
                ã€Œ*ã€ã®ã¤ã„ã¦ã„ãªã„ã‚‚ã®ã®ã¿ã«çµã‚‹ / Filter out asterisk-marked results
            </label>
        </div>

        <div class="checkbox-section">
            <label for="showInternal">
                <input type="checkbox" id="showInternal">
                å†…éƒ¨å€¤ã‚’è¡¨ç¤º / Show internal values
            </label>
        </div>

        <button id="calculate">è¨ˆç®—é–‹å§‹ / Generate </button>
        
        <div id="progress">
            <div id="progress-bar">0%</div>
        </div>

        <div id="results"></div>
    </div>

    <script>
        // å®šæ•°
        const s = 16;
        const MAX = 10000;
        const UNUSED = 0;
        const VALID = 1;
        const INVALID = 2;
        let t; // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã¨ã—ã¦å‘¨æœŸtã‚’å®£è¨€
        
        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ã‚’è¡¨ç¤º
        console.log("ã‚­ãƒã‚³ãƒ«ãƒ¼ãƒ—ç”Ÿæˆæ©Ÿ / Mushloop Generator - Ver 1.7.0");
        console.log("s = " + s);  // sã®å€¤ã‚’ç¢ºèª

        document.getElementById('calculate').addEventListener('click', function() {
            t = parseInt(document.getElementById('period').value);
            const dispMAX = parseInt(document.getElementById('displayCount').value);
            const sortOrder = parseInt(document.getElementById('sortOrder').value);
            const filterForMusicBlock = document.getElementById('filterForMusicBlock').checked;
            const filterNoAsterisk = document.getElementById('filterNoAsterisk').checked;
            
            if (isNaN(t) || t <= 0) {
                alert('æœ‰åŠ¹ãªå‘¨æœŸã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            // å¥‡æ•°ã®å‘¨æœŸã‚’ãƒã‚§ãƒƒã‚¯
            if (t % 2 !== 0) {
                alert('å¥‡æ•°å‘¨æœŸã®ãƒ«ãƒ¼ãƒ—ã¯ç”Ÿæˆã§ãã¾ã›ã‚“ã€‚å¶æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚/ Odd-period loops cannot be generated. Please enter an even number.');
                return;
            }
            
            // å¤§ãã™ãã‚‹å€¤ã®ãƒã‚§ãƒƒã‚¯
            if (t > 10000) {
                alert('å€¤ãŒå¤§ãã™ãã¾ã™ / Value is too large');
                return;
            }
            
            if (isNaN(dispMAX) || dispMAX <= 0) {
                alert('æœ‰åŠ¹ãªè¡¨ç¤ºæ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            // è¨ˆç®—ã®å®Ÿè¡Œ
            calculateResults(t, dispMAX, sortOrder, filterForMusicBlock, filterNoAsterisk);
        });

        function calculateResults(t, dispMAX, sortOrder, filterForMusicBlock, filterNoAsterisk) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="result-count">è¨ˆç®—ä¸­...</div>';
            
            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®è¡¨ç¤º
            const progressContainer = document.getElementById('progress');
            const progressBar = document.getElementById('progress-bar');
            progressContainer.style.display = 'block';
            progressBar.style.width = '0%';
            progressBar.textContent = '0%';
            
            console.log("è¨ˆç®—é–‹å§‹: t = " + t);
            console.log("æ¥½å™¨ãƒ–ãƒ­ãƒƒã‚¯ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼: " + (filterForMusicBlock ? "ON" : "OFF"));
            console.log("ã‚¢ã‚¹ã‚¿ãƒªã‚¹ã‚¯ãªã—ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼: " + (filterNoAsterisk ? "ON" : "OFF"));
            
            // ç‰¹å®šã®çµ„ã¿åˆã‚ã›ã‚’ã¾ãšç¢ºèªï¼ˆt=66ã®å ´åˆï¼‰
            if (t === 66) {
                console.log("Checking special case for t=66: (a=1, g=2, b=0, c=0, d=0, e=0, f=0)");
                const a = 1, g = 2, b = 0, c = 0, d = 0, e = 0, f = 0;
                
                // åˆ‡ã‚Šæ¨ã¦å‰ã®å€¤ã‚’è¨ˆç®—
                const rawValue = (c + e / 4.0 + 3 * f / 4.0) * (s * Math.sqrt(5)) +
                    (b + d / 2.0) * (s * Math.sqrt(2)) +
                    (a + g / 2.0) * s + 1.001;
                
                // åˆ‡ã‚Šæ¨ã¦å€¤ã‚’è¨ˆç®—ï¼ˆå°æ•°éƒ¨åˆ†ï¼‰
                const cut = rawValue - Math.floor(rawValue);
                
                const middle = 2 * Math.floor(rawValue);
                const r = t - middle;
                console.log(`Special case: middle=${middle}, r=${r}, cut=${cut.toFixed(4)}`);
            }
            
            // çµæœã‚’æ ¼ç´ã™ã‚‹é…åˆ—
            const result = new Array(MAX);
            for (let k = 0; k < MAX; k++) {
                result[k] = new Array(10); // cutã®è¿½åŠ ã®ãŸã‚é…åˆ—ã‚µã‚¤ã‚ºã‚’å¢—ã‚„ã™
                result[k][8] = UNUSED;
            }
            
            // ãƒ‡ãƒãƒƒã‚°ç”¨ã®ç‰¹å®šæ¡ä»¶ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼
            let debugCounter = 0;
            
            // éåŒæœŸã§è¨ˆç®—ã‚’è¡Œã†
            setTimeout(() => {
                let i = 0;
                
                // å„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®çµ„ã¿åˆã‚ã›ã‚’ãƒã‚§ãƒƒã‚¯
                let aMax = Math.ceil(t / (2 * s));  // aã®æœ€å¤§å€¤ã‚’æ­£ç¢ºã«è¨ˆç®—
                for (let a = 0; a <= aMax; a++) {
                    // æ¥½å™¨ãƒ–ãƒ­ãƒƒã‚¯ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãŒæœ‰åŠ¹ãªå ´åˆã¯a>=1ã®æ¡ä»¶ã‚’é©ç”¨
                    if (filterForMusicBlock && a < 1) {
                        continue;  // a<1ã®å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
                    }
                    
                    // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®æ›´æ–°ï¼ˆaå€¤ã«åŸºã¥ã„ã¦ç°¡æ˜“çš„ã«ï¼‰
                    updateProgressBar(a, aMax);
                    
                    for (let g = 0; g <= 2; g++) {  // gã‚’å¤–å´ã®ãƒ«ãƒ¼ãƒ—ã«ç§»å‹•ã—ã¦åŠ¹ç‡åŒ–
                        // æ¥½å™¨ãƒ–ãƒ­ãƒƒã‚¯ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãŒæœ‰åŠ¹ãªå ´åˆã¯g=1ã¾ãŸã¯g=2ã®æ¡ä»¶ã‚’é©ç”¨
                        if (filterForMusicBlock && !(g === 1 || g === 2)) {
                            continue;  // g=0ã®å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
                        }
                        
                        // aã¨gã®çµ„ã¿åˆã‚ã›ã«ã‚ˆã‚‹ãƒã‚§ãƒƒã‚¯
                        if ((a + g / 2.0) * s * 2 > t) {
                            continue;  // ã“ã®çµ„ã¿åˆã‚ã›ã§ã¯å‘¨æœŸã‚’è¶…ãˆã‚‹ãŸã‚è¨ˆç®—ã—ãªã„
                        }
                        
                        for (let b = 0; b <= Math.ceil(t / (s * Math.sqrt(2))); b++) {
                            for (let c = 0; c <= Math.ceil(t / (2 * s * Math.sqrt(5))); c++) {
                                for (let d = 0; d <= 2; d++) {  // d,e,f,gã¯0,1,2ã‚’å–ã‚‹
                                    for (let e = 0; e <= 2; e++) {
                                        for (let f = 0; f <= 2; f++) {
                                            // d+e+f+g=2ã®æ¡ä»¶ã‚’é©ç”¨
                                            if (d + e + f + g !== 2) {
                                                continue;
                                            }

                                            // åˆ‡ã‚Šæ¨ã¦å‰ã®å€¤ã‚’è¨ˆç®—
                                            const rawValue = (c + e / 4.0 + 3 * f / 4.0) * (s * Math.sqrt(5)) +
                                                (b + d / 2.0) * (s * Math.sqrt(2)) +
                                                (a + g / 2.0) * s + 1.001; // 1.001ã«ä¿®æ­£ (ä¸¸ã‚èª¤å·®ã‚’é˜²æ­¢)
                                            
                                            // åˆ‡ã‚Šæ¨ã¦å€¤ã‚’è¨ˆç®—ï¼ˆå°æ•°éƒ¨åˆ†ï¼‰
                                            const cut = rawValue - Math.floor(rawValue);
                                            
                                            // middleã®è¨ˆç®—
                                            const middle = 2 * Math.floor(rawValue);
                                            
                                            // t=66ã®å ´åˆã¯é‡è¦ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ãƒ­ã‚°å‡ºåŠ›
                                            if (t === 66 && ((a === 1 && g === 2) || (a === 2 && g === 0))) {
                                                console.log(`Debug: a=${a}, b=${b}, c=${c}, d=${d}, e=${e}, f=${f}, g=${g}, middle=${middle}, t=${t}, r=${t-middle}, cut=${cut.toFixed(4)}`);
                                                debugCounter++;
                                            }
                                            
                                            if (i >= MAX) {
                                                console.log("Result array is full!");
                                                break;
                                            }
                                            
                                            // r(=t-middle)ã®è¨ˆç®—
                                            const r = t - middle;
                                            
                                            // ç²¾åº¦ã®å•é¡Œã‚’è€ƒæ…®ã—ã¦ã€å°ã•ãªèª¤å·®ã‚’è¨±å®¹ã—ã¦ r=0 ã¨åˆ¤å®š
                                            // å®Œå…¨ã«åŒã˜çµæœã‚’é¿ã‘ã‚‹ãŸã‚ã«çµ„ã¿åˆã‚ã›ã®ä¸€æ„æ€§ã‚’ãƒã‚§ãƒƒã‚¯
                                            if (Math.abs(r) < 0.001) { // ã‚ˆã‚Šå³å¯†ãªåˆ¤å®š
                                                // æ—¢å­˜ã®çµæœã¨é‡è¤‡ãŒãªã„ã‹ãƒã‚§ãƒƒã‚¯
                                                let isDuplicate = false;
                                                for (let k = 0; k < i; k++) {
                                                    if (result[k][8] === VALID && 
                                                        result[k][0] === a && 
                                                        result[k][1] === b &&
                                                        result[k][2] === c &&
                                                        result[k][3] === d &&
                                                        result[k][4] === e &&
                                                        result[k][5] === f &&
                                                        result[k][7] === g) {
                                                        isDuplicate = true;
                                                        break;
                                                    }
                                                }
                                                
                                                if (!isDuplicate) {
                                                    result[i][0] = a;
                                                    result[i][1] = b;
                                                    result[i][2] = c;
                                                    result[i][3] = d;
                                                    result[i][4] = e;
                                                    result[i][5] = f;
                                                    result[i][6] = r;
                                                    result[i][7] = g;  // gã‚’ä¿å­˜
                                                    result[i][8] = VALID;
                                                    result[i][9] = cut;  // åˆ‡ã‚Šæ¨ã¦å€¤ã‚’ä¿å­˜
                                                    i++;
                                                    
                                                    // ãƒ‡ãƒãƒƒã‚°: æœ‰åŠ¹ãªçµ„ã¿åˆã‚ã›ã‚’ç™ºè¦‹ã—ãŸå ´åˆã«ãƒ­ã‚°å‡ºåŠ›
                                                    console.log(`æœ‰åŠ¹ãªçµ„ã¿åˆã‚ã›: a=${a}, b=${b}, c=${c}, d=${d}, e=${e}, f=${f}, g=${g}, middle=${middle}, t=${t}, r=${r}, cut=${cut.toFixed(4)}, åœ°é¢=${a + g/2 + d/2 + e/2 + f/2}`);
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                
                // çµæœã‚’ä¸¦ã³æ›¿ãˆ
                sortResults(result, sortOrder);
                
                // VALIDæ•°ã‚’æ•°ãˆã‚‹
                let n = 0;
                for (let j = 0; j < MAX; j++) {
                    if (result[j][8] === VALID)
                        n++;
                    else if (result[j][8] === UNUSED)
                        break;
                }
                
                // çµæœã®è¡¨ç¤º
                displayResults(result, n, dispMAX, filterForMusicBlock, filterNoAsterisk);
                
                // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚’100%ã«
                progressBar.style.width = '100%';
                progressBar.textContent = '100%';
                
                // ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã®è¡¨ç¤º
                if (t === 66 || t === 78) {
                    console.log(`Total debug combinations checked: ${debugCounter}`);
                }
                
                console.log("è¨ˆç®—å®Œäº†");
            }, 100); // ã™ãã«è¨ˆç®—ã‚’å§‹ã‚ã‚‹ãŒã€UIã®æ›´æ–°ã®ãŸã‚ã«å°‘ã—é…å»¶
        }
        
        function sortResults(result, sortOrder) {
            // ä¸¦ã³æ›¿ãˆå¯¾è±¡ã®ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡º
            const validResults = [];
            for (let j = 0; j < MAX; j++) {
                if (result[j][8] === VALID) {
                    validResults.push(result[j]);
                } else if (result[j][8] === UNUSED) {
                    break;
                }
            }
            
            // åœ°é¢ã®å€¤ã§ã‚½ãƒ¼ãƒˆ (a + g/2 + d/2 + e/2 + f/2)
            validResults.sort((a, b) => {
                const groundValueA = a[0] + a[7]/2 + a[3]/2 + a[4]/2 + a[5]/2;
                const groundValueB = b[0] + b[7]/2 + b[3]/2 + b[4]/2 + b[5]/2;
                
                if (sortOrder === 1) {
                    return groundValueB - groundValueA; // å¤§ãã„é †
                } else {
                    return groundValueA - groundValueB; // å°ã•ã„é †
                }
            });
            
            // å…ƒã®é…åˆ—ã«æˆ»ã™
            for (let j = 0; j < validResults.length; j++) {
                result[j] = validResults[j];
            }
            
            // æ®‹ã‚Šã‚’UNUSEDã«ã™ã‚‹
            for (let j = validResults.length; j < MAX; j++) {
                if (!result[j]) {
                    result[j] = new Array(10);
                }
                result[j][8] = UNUSED;
            }
        }
        
        function updateProgressBar(currentA, maxA) {
            const progressContainer = document.getElementById('progress');
            const progressBar = document.getElementById('progress-bar');
            
            const progress = Math.min(100, Math.floor((currentA / maxA) * 100));
            
            progressBar.style.width = progress + '%';
            progressBar.textContent = progress + '%';
        }
        
        function displayResults(result, n, dispMAX, filterForMusicBlock, filterNoAsterisk) {
            const resultsDiv = document.getElementById('results');
            const showInternal = document.getElementById('showInternal').checked;
            resultsDiv.innerHTML = '';
            
            // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã•ã‚ŒãŸçµæœã‚’ã‚«ã‚¦ãƒ³ãƒˆ
            let filteredCount = 0;
            for (let j = 0; j < MAX; j++) {
                if (result[j][8] === VALID) {
                    const a = result[j][0];
                    const g = result[j][7];
                    const cut = result[j][9];
                    
                    // æ¥½å™¨ãƒ–ãƒ­ãƒƒã‚¯ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®é©ç”¨
                    if (filterForMusicBlock && (g !== 1 && g !== 2 || a < 1)) {
                        continue;
                    }
                    
                    // ã‚¢ã‚¹ã‚¿ãƒªã‚¹ã‚¯ãªã—ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®é©ç”¨
                    if (filterNoAsterisk && cut >= 0.9) {
                        continue;
                    }
                    
                    filteredCount++;
                } else if (result[j][8] === UNUSED) {
                    break;
                }
            }
            
            // çµæœã®ä»¶æ•°è¡¨ç¤º
            const countDiv = document.createElement('div');
            countDiv.className = 'result-count';
            
            let filterMessage = '';
            if (filterForMusicBlock && filterNoAsterisk) {
                filterMessage = 'ï¼ˆæ¥½å™¨ãƒ–ãƒ­ãƒƒã‚¯é…ç½®å¯èƒ½ã§ã€Œ*ã€ãªã—ã®çµæœã®ã¿è¡¨ç¤ºï¼‰';
            } else if (filterForMusicBlock) {
                filterMessage = 'ï¼ˆæ¥½å™¨ãƒ–ãƒ­ãƒƒã‚¯é…ç½®å¯èƒ½ãªçµæœã®ã¿è¡¨ç¤ºï¼‰';
            } else if (filterNoAsterisk) {
                filterMessage = 'ï¼ˆã€Œ*ã€ãªã—ã®çµæœã®ã¿è¡¨ç¤ºï¼‰';
            }
            
            countDiv.textContent = `${filteredCount}å€‹ã®çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ${filterMessage}`;
            resultsDiv.appendChild(countDiv);
            
            // çµæœãŒ0ä»¶ã®å ´åˆ
            if (filteredCount === 0) {
                const noResultDiv = document.createElement('div');
                noResultDiv.className = 'result-item';
                noResultDiv.textContent = 'æ¡ä»¶ã‚’æº€ãŸã™çµæœãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸ / Not found';
                resultsDiv.appendChild(noResultDiv);
                return;
            }
            
            // è¡¨ç¤ºä»¶æ•°ã®ã‚«ã‚¦ãƒ³ãƒˆ
            let countdisp = 0;
            
            // çµæœã®è¡¨ç¤º
            for (let j = 0; j < MAX && countdisp < Math.min(dispMAX, filteredCount); j++) {
                if (result[j][8] === VALID) {
                    // å€¤ã®å–å¾—
                    const a = result[j][0];
                    const b = result[j][1];
                    const c = result[j][2];
                    const d = result[j][3];
                    const e = result[j][4];
                    const f = result[j][5];
                    const g = result[j][7];
                    const cut = result[j][9]; // åˆ‡ã‚Šæ¨ã¦å€¤
                    
                    // æ¥½å™¨ãƒ–ãƒ­ãƒƒã‚¯ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®é©ç”¨
                    if (filterForMusicBlock && (g !== 1 && g !== 2 || a < 1)) {
                        continue;
                    }
                    
                    // ã‚¢ã‚¹ã‚¿ãƒªã‚¹ã‚¯ãªã—ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®é©ç”¨
                    if (filterNoAsterisk && cut >= 0.9) {
                        continue;
                    }
                    
                    const resultItem = document.createElement('div');
                    resultItem.className = 'result-item';
                    
                    // åˆ‡ã‚Šæ¨ã¦å€¤ãŒ0.9ä»¥ä¸Šã®å ´åˆã€ã‚¢ã‚¹ã‚¿ãƒªã‚¹ã‚¯ã‚’è¡¨ç¤º
                    const asterisk = cut >= 0.9 ? '*' : '';
                    
                    // åœ°é¢ã®å€¤ã®è¨ˆç®—ã¨è¡¨ç¤º
                    const groundA = a;
                    const groundG = g/2;
                    const groundGDisplay = groundG === Math.floor(groundG) ? 
                        groundG : groundG.toFixed(1);
                    
                    // æ€¥ãªå‚ã®è¨ˆç®—å€¤
                    const steepB = b;
                    const steepD = d/2;
                    // å°æ•°ç‚¹ä»¥ä¸‹ãŒãªã„å ´åˆã¯æ•´æ•°è¡¨ç¤ºã€ã‚ã‚‹å ´åˆã¯å°æ•°ç‚¹è¡¨ç¤º
                    const steepDDisplay = steepD === Math.floor(steepD) ? 
                        steepD : steepD.toFixed(1);
                    
                    // ç·©ã‚„ã‹ãªå‚ã®è¨ˆç®—å€¤
                    const gentleC = c;
                    const gentleEF = e/4 + 3*f/4;
                    // å°æ•°ç‚¹ä»¥ä¸‹ãŒãªã„å ´åˆã¯æ•´æ•°è¡¨ç¤ºã€ã‚ã‚‹å ´åˆã¯å°æ•°ç‚¹è¡¨ç¤º
                    const gentleEFDisplay = gentleEF === Math.floor(gentleEF) ? 
                        gentleEF : gentleEF.toFixed(2);
                    
                    // æ¥½å™¨ãƒ–ãƒ­ãƒƒã‚¯é…ç½®å¯èƒ½ãªæ¡ä»¶ã‚’æº€ãŸã™å ´åˆã«è¡¨ç¤ºã™ã‚‹ãƒãƒ¼ã‚¯
                    const musicBlockMark = (g === 1 || g === 2) && a >= 1 ? ' ğŸµ' : '';
                    
                    let resultHTML = `
                        <strong>çµæœ Result ${countdisp + 1}${asterisk}${musicBlockMark}</strong><br>
                        åœ°é¢ (Ground): ${groundA} + ${groundGDisplay}<br>
                        æ€¥ãªå‚ (Steep Slope): ${steepB} + ${steepDDisplay}<br>
                        ç·©ã‚„ã‹ãªå‚ (Gentle Slope): ${gentleC} + ${gentleEFDisplay}
                    `;
                    
                    // å†…éƒ¨å€¤ã®è¡¨ç¤ºã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒONã®å ´åˆ
                    if (showInternal) {
                        resultHTML += `
                        <div class="internal-values">
                            ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿: a=${a}, b=${b}, c=${c}, d=${d}, e=${e}, f=${f}, g=${g}<br>
                            åˆ‡ã‚Šæ¨ã¦å€¤ (Cut value): ${cut.toFixed(4)}
                        </div>`;
                    }
                    
                    resultItem.innerHTML = resultHTML;
                    
                    resultsDiv.appendChild(resultItem);
                    countdisp++;
                }
            }
        }
    </script>
</body>
</html>
