<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚­ãƒã‚³ãƒ«ãƒ¼ãƒ—ç”Ÿæˆæ©Ÿ / Mushloop Generator</title>
    <style>
        body{font-family:'Meiryo',sans-serif;max-width:800px;margin:0 auto;padding:20px;background:#f5f5f5}
        h1{color:#333;text-align:center}
        .warning{color:#d32f2f;text-align:center;font-weight:bold;margin-bottom:5px}
        .version,.credit{color:#666;text-align:center;font-size:.9em;margin:5px 0 15px}
        .credit{font-size:.8em}
        .container{background:#fff;border-radius:8px;padding:20px;box-shadow:0 0 10px rgba(0,0,0,.1)}
        .input-section{margin-bottom:20px}
        .input-section label{display:block;margin-bottom:5px;font-weight:bold}
        .input-section input,.input-section select{width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;box-sizing:border-box}
        .checkbox-section{margin-bottom:15px}
        .checkbox-section label{display:inline-flex;align-items:center;cursor:pointer}
        .checkbox-section input{margin-right:8px}
        button{background:#4CAF50;color:#fff;padding:10px 15px;border:none;border-radius:4px;cursor:pointer;font-size:16px;width:100%}
        button:hover{background:#45a049}
        #results{margin-top:20px}
        .result-item{background:#f9f9f9;border-left:4px solid #4CAF50;padding:15px;margin-bottom:10px;border-radius:4px}
        .internal-values{margin-top:8px;padding-top:8px;border-top:1px dashed #ccc;font-size:.9em;color:#666}
        #progress{width:100%;background:#ddd;margin-top:10px;display:none}
        #progress-bar{width:0;height:20px;background:#4CAF50;text-align:center;line-height:20px;color:#fff}
        .result-count{text-align:center;font-weight:bold;margin:15px 0}
        footer{margin-top:30px;text-align:center;font-size:.9em;color:#666;padding:10px}
        details.explanation{margin-bottom:20px;border:1px solid #ddd;border-radius:4px;overflow:hidden}
        details.explanation summary{padding:10px 15px;background:#f0f0f0;cursor:pointer;font-weight:bold}
        details.explanation .explanation-content{padding:15px;background:#fdfdfd;border-top:1px solid #ddd}
        .important{color:#d32f2f}
        .batch-section{margin-top:20px;padding-top:15px;border-top:2px dashed #ccc}
        .period-header{background:#4CAF50;color:white;padding:10px;margin-top:20px;border-radius:4px;font-weight:bold}
        .batch-result-count{text-align:right;font-size:0.9em;color:#666;margin-bottom:5px}
        .batch-input{display:flex;gap:10px;align-items:center;margin-bottom:15px}
        .batch-input input{flex:1}
        .batch-input label{flex:0 0 auto;margin-bottom:0}
        .batch-divider{height:1px;background:#ccc;margin:15px 0}
    </style>
</head>
<body>
    <h1>ã‚­ãƒã‚³ãƒ«ãƒ¼ãƒ—ç”Ÿæˆæ©ŸÎ² / Mushloop Generator</h1>
    <p class="credit">Made by Claude(AI) with N / 5mm (X:@N_SMM2)</p>
    <div class="container">
        <p class="warning">å¥‡æ•°å‘¨æœŸã®ãƒ«ãƒ¼ãƒ—ã¯ç”Ÿæˆã§ãã¾ã›ã‚“ / Odd-period loops cannot be generated</p>
        <p class="version">Î² Ver 1.7.3 Last Update: 2025/5/18</p>
        
        <details class="explanation">
            <summary>èª¬æ˜ / Explanation</summary>
            <div class="explanation-content">
                <p>ã‚­ãƒã‚³ãƒ«ãƒ¼ãƒ—ã®å‘¨æœŸã‹ã‚‰é…ç½®ã™ã¹ãåœ°å½¢ãƒ‘ãƒ¼ãƒ„ã®æ•°ã‚’æ±‚ã‚ã¦ãã‚Œã¾ã™ã€‚è¡¨ç¤ºã•ã‚Œã‚‹å€¤ã¯ãƒ«ãƒ¼ãƒ—ã®æ¨ªå¹…ã§ã¯ãªãå®Ÿå‹•è·é›¢ã§ã‚ã‚Šã€ä¸¡ç«¯0.5ãƒã‚¹åˆ†ã¯ã‚«ã‚¦ãƒ³ãƒˆã•ã‚Œã¦ã„ãªã„ã“ã¨ã«æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚</p>
                <p>çµæœã¯è¶³ã—ç®—ã®å½¢ã§è¡¨ç¤ºã•ã‚Œã€ãã®ã†ã¡å³å´ã®æ•°å­—ãŒç«¯ç‚¹éƒ¨ã®é•·ã•ã€å·¦å´ã®æ•°å­—ãŒä¸­é–“éƒ¨ã®é•·ã•ã«ç›¸å½“ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€[<strong>çµæœ 5</strong> åœ°é¢ (Ground): 58 + 0 æ€¥ãªå‚ (Steep Slope): 2 + 0.5 ç·©ã‚„ã‹ãªå‚ (Gentle Slope): 0 + 0.75]ã¨è¡¨ç¤ºã•ã‚ŒãŸå ´åˆã«ã¯ã€ä¸€æ–¹ã®ç«¯ã«0.75å€‹+0.5ãƒã‚¹=2ãƒã‚¹(1å€‹)ã®ç·©ã‚„ã‹ãªå‚ã€ä¸€æ–¹ã®ç«¯ã«0.5å€‹+0.5ãƒã‚¹=1ãƒã‚¹(1å€‹)ã®æ€¥ãªå‚ã€ãã®é–“ã«58å€‹ã®å¹³ã‚‰ãªåœ°å½¢ã‚’ç½®ãã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚</p>
                <p class="important">ã‚¢ã‚¹ã‚¿ãƒªã‚¹ã‚¯(*)ã®ã¤ã„ãŸã‚‚ã®ã¯æ—¢çŸ¥ã®æ–¹ç¨‹å¼ã«å½“ã¦ã¯ã¾ã‚‰ãªã„æŒ™å‹•ã‚’ç¤ºã™å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€ä½¿ã†ã®ã‚’ãŠã™ã™ã‚ã—ã¾ã›ã‚“ã€‚</p>
                <hr>
                <p>This tool calculates the number of terrain elements needed for a mushroom loop based on its period. The displayed values represent actual travel distance, not loop width, and it's important to note that the 0.5 tiles at both ends are not counted.</p>
                <p>The result is displayed as a sum, where the number on the right represents the length of the end section, and the number on the left corresponds to the length of the middle section. For example, if you see [<strong>Result 5</strong> Ground: 58 + 0 Steep Slope: 2 + 0.5 Gentle Slope: 0 + 0.75], it means you should place 0.75 pieces + 0.5 tiles = 2 tiles (1 piece) of gentle slope at one end, 0.5 pieces + 0.5 tiles = 1 tile (1 piece) of steep slope at the other end, and 58 flat tiles in between.</p>
                <p class="important">Results marked with an asterisk (*) may not follow known equations and are not recommended for use.</p>
                <hr>
                <p>0.5=0.25+0.25, 1=0.5+0.5=0.25+0.75, 1.5=0.75+0.75</p>
            </div>
        </details>
        
        <div class="input-section">
            <label for="period">å‘¨æœŸ/Period[f]:</label>
            <input type="number" id="period" min="2" step="2" value="400">
        </div>
        
        <div class="input-section">
            <label for="displayCount">è¡¨ç¤ºã™ã‚‹çµæœã®æ•° (Results to display):</label>
            <input type="number" id="displayCount" min="1" value="5">
        </div>

        <div class="input-section">
            <label for="sortOrder">ä¸¦ã³æ›¿ãˆ (Sort Order):</label>
            <select id="sortOrder">
                <option value="1">åœ°é¢ã®å€¤ãŒå¤§ãã„é † (Ground value descending)</option>
                <option value="2">åœ°é¢ã®å€¤ãŒå°ã•ã„é † (Ground value ascending)</option>
            </select>
        </div>

        <div class="checkbox-section">
            <label for="filterForMusicBlock">
                <input type="checkbox" id="filterForMusicBlock">
                æ¥½å™¨ãƒ–ãƒ­ãƒƒã‚¯ã‚’ç¢ºå®Ÿã«é…ç½®ã§ãã‚‹ã‚‚ã®ã®ã¿ã«çµã‚‹ / Filter for music block placement
            </label>
        </div>

        <div class="checkbox-section">
            <label for="filterNoAsterisk">
                <input type="checkbox" id="filterNoAsterisk">
                ã€Œ*ã€ã®ã¤ã„ã¦ã„ãªã„ã‚‚ã®ã®ã¿ã«çµã‚‹ / Filter out asterisk-marked results
            </label>
        </div>

        <div class="checkbox-section">
            <label for="showInternal">
                <input type="checkbox" id="showInternal">
                å†…éƒ¨å€¤ã‚’è¡¨ç¤º / Show internal values
            </label>
        </div>

        <div class="checkbox-section">
            <label for="batchMode">
                <input type="checkbox" id="batchMode">
                ã¾ã¨ã‚ã¦æ¢ã™ / Batch Search
            </label>
        </div>

        <div id="batchInputs" class="batch-section" style="display:none">
            <div class="batch-input">
                <label for="startPeriod">é–‹å§‹å‘¨æœŸ / Start Period:</label>
                <input type="number" id="startPeriod" min="2" step="2" value="350">
                <label for="endPeriod">çµ‚äº†å‘¨æœŸ / End Period:</label>
                <input type="number" id="endPeriod" min="2" step="2" value="400">
            </div>
            <div class="batch-divider"></div>
        </div>

        <button id="calculate">è¨ˆç®—é–‹å§‹ / Generate</button>
        
        <div id="progress">
            <div id="progress-bar">0%</div>
        </div>

        <div id="results"></div>
    </div>

    <script>
        // å®šæ•°ã¨å¤‰æ•°
        const s = 16;
        let t;
        
        // ãƒãƒƒãƒãƒ¢ãƒ¼ãƒ‰ã®ãƒˆã‚°ãƒ«
        document.getElementById('batchMode').addEventListener('change', function() {
            document.getElementById('batchInputs').style.display = this.checked ? 'block' : 'none';
        });
        
        document.getElementById('calculate').addEventListener('click', function() {
            const batchMode = document.getElementById('batchMode').checked;
            const dispMAX = parseInt(document.getElementById('displayCount').value);
            const sortOrder = parseInt(document.getElementById('sortOrder').value);
            const filterForMusicBlock = document.getElementById('filterForMusicBlock').checked;
            const filterNoAsterisk = document.getElementById('filterNoAsterisk').checked;
            
            if (batchMode) {
                // ãƒãƒƒãƒãƒ¢ãƒ¼ãƒ‰å‡¦ç†
                const startPeriod = parseInt(document.getElementById('startPeriod').value);
                const endPeriod = parseInt(document.getElementById('endPeriod').value);
                
                if (isNaN(startPeriod) || isNaN(endPeriod) || startPeriod <= 0 || endPeriod <= 0) {
                    alert('æœ‰åŠ¹ãªå‘¨æœŸã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ / Please enter valid periods');
                    return;
                }
                
                if (startPeriod % 2 !== 0 || endPeriod % 2 !== 0) {
                    alert('å¥‡æ•°å‘¨æœŸã®ãƒ«ãƒ¼ãƒ—ã¯ç”Ÿæˆã§ãã¾ã›ã‚“ã€‚å¶æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚/ Odd-period loops cannot be generated. Please enter even numbers.');
                    return;
                }
                
                if (startPeriod > endPeriod) {
                    alert('é–‹å§‹å‘¨æœŸã¯çµ‚äº†å‘¨æœŸä»¥ä¸‹ã«ã—ã¦ãã ã•ã„ / Start period should be less than or equal to end period');
                    return;
                }
                
                if (endPeriod - startPeriod > 128) {
                    alert('å‘¨æœŸã®ç¯„å›²ã¯128ä»¥ä¸‹ã«ã—ã¦ãã ã•ã„ / Period range should be 128 or less');
                    return;
                }
                
                if (endPeriod > 2000) {
                    alert('å€¤ãŒå¤§ãã™ãã¾ã™ / Value is too large');
                    return;
                }
                
                batchCalculate(startPeriod, endPeriod, dispMAX, sortOrder, filterForMusicBlock, filterNoAsterisk);
            } else {
                // é€šå¸¸ãƒ¢ãƒ¼ãƒ‰å‡¦ç†
                t = parseInt(document.getElementById('period').value);
                
                if (isNaN(t) || t <= 0) {
                    alert('æœ‰åŠ¹ãªå‘¨æœŸã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ / Please enter a valid period');
                    return;
                }
                
                if (t % 2 !== 0) {
                    alert('å¥‡æ•°å‘¨æœŸã®ãƒ«ãƒ¼ãƒ—ã¯ç”Ÿæˆã§ãã¾ã›ã‚“ã€‚å¶æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚/ Odd-period loops cannot be generated. Enter an even number.');
                    return;
                }
                
                if (t > 10000) {
                    alert('å€¤ãŒå¤§ãã™ãã¾ã™ / Value is too large');
                    return;
                }
                
                if (isNaN(dispMAX) || dispMAX <= 0) {
                    alert('æœ‰åŠ¹ãªè¡¨ç¤ºæ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ / Please enter a valid display count');
                    return;
                }
                
                calculateResults(t, dispMAX, sortOrder, filterForMusicBlock, filterNoAsterisk);
            }
        });

        function batchCalculate(startPeriod, endPeriod, dispMAX, sortOrder, filterForMusicBlock, filterNoAsterisk) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="result-count">è¨ˆç®—ä¸­... / Calculating...</div>';
            
            const progressContainer = document.getElementById('progress');
            const progressBar = document.getElementById('progress-bar');
            progressContainer.style.display = 'block';
            progressBar.style.width = '0%';
            progressBar.textContent = '0%';
            
            // ãƒãƒƒãƒå‡¦ç†ç”¨ã®é…åˆ—
            const batchResults = [];
            const periodsToProcess = [];
            
            // å‡¦ç†ã™ã‚‹å‘¨æœŸã‚’é…åˆ—ã«æ ¼ç´
            for (let period = startPeriod; period <= endPeriod; period += 2) {
                periodsToProcess.push(period);
            }
            
            let processedCount = 0;
            
            // éåŒæœŸã§ä¸€ã¤ãšã¤å‡¦ç†
            function processNextPeriod() {
                if (processedCount >= periodsToProcess.length) {
                    // ã™ã¹ã¦ã®å‡¦ç†ãŒå®Œäº†
                    displayBatchResults(batchResults, dispMAX, filterForMusicBlock, filterNoAsterisk);
                    progressBar.style.width = '100%';
                    progressBar.textContent = '100%';
                    return;
                }
                
                const currentPeriod = periodsToProcess[processedCount];
                
                // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®æ›´æ–°
                updateProgressBar(processedCount, periodsToProcess.length);
                
                // å‘¨æœŸã”ã¨ã®çµæœã‚’è¨ˆç®—
                const periodResults = calculatePeriodResults(currentPeriod, sortOrder);
                batchResults.push({
                    period: currentPeriod,
                    results: periodResults
                });
                
                processedCount++;
                
                // æ¬¡ã®å‘¨æœŸã‚’å‡¦ç†
                setTimeout(processNextPeriod, 10);
            }
            
            // å‡¦ç†é–‹å§‹
            setTimeout(processNextPeriod, 10);
        }
        
        function calculatePeriodResults(period, sortOrder) {
            t = period; // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°tã«è¨­å®š
            
            // çµæœã‚’æ ¼ç´ã™ã‚‹é…åˆ—
            const result = [];
            
            // å„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®çµ„ã¿åˆã‚ã›ã‚’ãƒã‚§ãƒƒã‚¯
            let aMax = Math.ceil(t / (2 * s));  // aã®æœ€å¤§å€¤
            for (let a = 0; a <= aMax; a++) {
                for (let g = 0; g <= 2; g++) {
                    // aã¨gã®çµ„ã¿åˆã‚ã›ã«ã‚ˆã‚‹ãƒã‚§ãƒƒã‚¯
                    if ((a + g / 2.0) * s * 2 > t) continue;
                    
                    for (let b = 0; b <= Math.ceil(t / (s * Math.sqrt(2))); b++) {
                        for (let c = 0; c <= Math.ceil(t / (2 * s * Math.sqrt(5))); c++) {
                            for (let d = 0; d <= 2; d++) {
                                for (let e = 0; e <= 2; e++) {
                                    for (let f = 0; f <= 2; f++) {
                                        // d+e+f+g=2ã®æ¡ä»¶ã‚’é©ç”¨
                                        if (d + e + f + g !== 2) continue;

                                        // åˆ‡ã‚Šæ¨ã¦å‰ã®å€¤ã‚’è¨ˆç®—
                                        const rawValue = (c + e / 4.0 + 3 * f / 4.0) * (s * Math.sqrt(5)) +
                                            (b + d / 2.0) * (s * Math.sqrt(2)) +
                                            (a + g / 2.0) * s + 1.001;
                                        
                                        // åˆ‡ã‚Šæ¨ã¦å€¤ã¨ä¸­é–“ã®è¨ˆç®—
                                        const cut = rawValue - Math.floor(rawValue);
                                        const middle = 2 * Math.floor(rawValue);
                                        
                                        // r(=t-middle)ã®è¨ˆç®—
                                        const r = t - middle;
                                        
                                        // ç²¾åº¦ã®å•é¡Œã‚’è€ƒæ…®ã—ã¦ã€å°ã•ãªèª¤å·®ã‚’è¨±å®¹
                                        if (Math.abs(r) < 0.001) {
                                            // é‡è¤‡ãƒã‚§ãƒƒã‚¯
                                            let isDuplicate = result.some(item => 
                                                item[0] === a && item[1] === b && item[2] === c && 
                                                item[3] === d && item[4] === e && item[5] === f && item[7] === g
                                            );
                                            
                                            if (!isDuplicate) {
                                                result.push([a, b, c, d, e, f, r, g, 1, cut]);
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
            
            // çµæœã‚’ä¸¦ã³æ›¿ãˆ
            sortResults(result, sortOrder);
            return result;
        }

        function calculateResults(t, dispMAX, sortOrder, filterForMusicBlock, filterNoAsterisk) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="result-count">è¨ˆç®—ä¸­... / Calculating...</div>';
            
            const progressContainer = document.getElementById('progress');
            const progressBar = document.getElementById('progress-bar');
            progressContainer.style.display = 'block';
            progressBar.style.width = '0%';
            progressBar.textContent = '0%';
            
            setTimeout(() => {
                const result = calculatePeriodResults(t, sortOrder);
                
                // çµæœã®è¡¨ç¤º
                displayResults(result, result.length, dispMAX, filterForMusicBlock, filterNoAsterisk);
                
                // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚’100%ã«
                progressBar.style.width = '100%';
                progressBar.textContent = '100%';
            }, 100);
        }
        
        function sortResults(result, sortOrder) {
            // åœ°é¢ã®å€¤ã§ã‚½ãƒ¼ãƒˆ
            result.sort((a, b) => {
                const groundValueA = a[0] + a[7]/2 + a[3]/2 + a[4]/2 + a[5]/2;
                const groundValueB = b[0] + b[7]/2 + b[3]/2 + b[4]/2 + b[5]/2;
                
                return sortOrder === 1 ? groundValueB - groundValueA : groundValueA - groundValueB;
            });
        }
        
        function updateProgressBar(current, max) {
            const progressBar = document.getElementById('progress-bar');
            const progress = Math.min(100, Math.floor((current / max) * 100));
            progressBar.style.width = progress + '%';
            progressBar.textContent = progress + '%';
        }
        
        function displayBatchResults(batchResults, dispMAX, filterForMusicBlock, filterNoAsterisk) {
            const resultsDiv = document.getElementById('results');
            const showInternal = document.getElementById('showInternal').checked;
            resultsDiv.innerHTML = '';
            
            // çµ±è¨ˆæƒ…å ±
            let totalResults = 0;
            let totalFilteredResults = 0;
            
            // å„å‘¨æœŸã”ã¨ã®çµæœã‚’è¡¨ç¤º
            batchResults.forEach(periodData => {
                const period = periodData.period;
                const result = periodData.results;
                
                // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
                let filteredResults = result.filter(r => {
                    const a = r[0], b = r[1], c = r[2], d = r[3], e = r[4], f = r[5], g = r[7], cut = r[9];
                    
                    // æ¥½å™¨ãƒ–ãƒ­ãƒƒã‚¯ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
                    const musicBlockCondition = 
                        (g === 2 && b === 0 && c === 0 && d === 0 && e === 0 && f === 0) || 
                        (a >= 2 && g >= 1);
                        
                    if (filterForMusicBlock && !musicBlockCondition) return false;
                    
                    // ã‚¢ã‚¹ã‚¿ãƒªã‚¹ã‚¯ãªã—ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
                    if (filterNoAsterisk && cut >= 0.7225) return false;
                    
                    return true;
                });
                
                totalResults += result.length;
                totalFilteredResults += filteredResults.length;
                
                // å‘¨æœŸãƒ˜ãƒƒãƒ€ãƒ¼
                const periodHeader = document.createElement('div');
                periodHeader.className = 'period-header';
                periodHeader.textContent = `å‘¨æœŸ / Period: ${period}[f]`;
                resultsDiv.appendChild(periodHeader);
                
                // å‘¨æœŸã”ã¨ã®çµæœæ•°
                const countDiv = document.createElement('div');
                countDiv.className = 'batch-result-count';
                countDiv.textContent = `${filteredResults.length}å€‹ã®çµæœ`;
                resultsDiv.appendChild(countDiv);
                
                // çµæœãŒ0ä»¶ã®å ´åˆ
                if (filteredResults.length === 0) {
                    const noResultDiv = document.createElement('div');
                    noResultDiv.className = 'result-item';
                    noResultDiv.textContent = 'æ¡ä»¶ã‚’æº€ãŸã™çµæœãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸ / Not found';
                    resultsDiv.appendChild(noResultDiv);
                } else {
                    // çµæœè¡¨ç¤º
                    filteredResults.slice(0, dispMAX).forEach((r, idx) => {
                        displayResultItem(r, idx, showInternal, resultsDiv);
                    });
                }
            });
            
            // åˆè¨ˆçµæœæ•°è¡¨ç¤º
            const totalCountDiv = document.createElement('div');
            totalCountDiv.className = 'result-count';
            
            let filterMessage = '';
            if (filterForMusicBlock && filterNoAsterisk) {
                filterMessage = 'ï¼ˆæ¥½å™¨ãƒ–ãƒ­ãƒƒã‚¯é…ç½®å¯èƒ½ã§ã€Œ*ã€ãªã—ã®çµæœã®ã¿è¡¨ç¤ºï¼‰';
            } else if (filterForMusicBlock) {
                filterMessage = 'ï¼ˆæ¥½å™¨ãƒ–ãƒ­ãƒƒã‚¯é…ç½®å¯èƒ½ãªçµæœã®ã¿è¡¨ç¤ºï¼‰';
            } else if (filterNoAsterisk) {
                filterMessage = 'ï¼ˆã€Œ*ã€ãªã—ã®çµæœã®ã¿è¡¨ç¤ºï¼‰';
            }
            
            totalCountDiv.textContent = `åˆè¨ˆ${totalFilteredResults}å€‹ã®çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ${filterMessage} / Total ${totalFilteredResults} results found`;
            resultsDiv.insertBefore(totalCountDiv, resultsDiv.firstChild);
        }
        
        function displayResults(result, n, dispMAX, filterForMusicBlock, filterNoAsterisk) {
            const resultsDiv = document.getElementById('results');
            const showInternal = document.getElementById('showInternal').checked;
            resultsDiv.innerHTML = '';
            
            // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
            let filteredResults = result.filter(r => {
                const a = r[0], b = r[1], c = r[2], d = r[3], e = r[4], f = r[5], g = r[7], cut = r[9];
                
                // æ¥½å™¨ãƒ–ãƒ­ãƒƒã‚¯ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
                const musicBlockCondition = 
                    (g === 2 && b === 0 && c === 0 && d === 0 && e === 0 && f === 0) || 
                    (a >= 2 && g >= 1);
                    
                if (filterForMusicBlock && !musicBlockCondition) return false;
                
                // ã‚¢ã‚¹ã‚¿ãƒªã‚¹ã‚¯ãªã—ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
                if (filterNoAsterisk && cut >= 0.7225) return false;
                
                return true;
            });
            
            // çµæœæ•°è¡¨ç¤º
            const countDiv = document.createElement('div');
            countDiv.className = 'result-count';
            
            let filterMessage = '';
            if (filterForMusicBlock && filterNoAsterisk) {
                filterMessage = 'ï¼ˆæ¥½å™¨ãƒ–ãƒ­ãƒƒã‚¯é…ç½®å¯èƒ½ã§ã€Œ*ã€ãªã—ã®çµæœã®ã¿è¡¨ç¤ºï¼‰';
            } else if (filterForMusicBlock) {
                filterMessage = 'ï¼ˆæ¥½å™¨ãƒ–ãƒ­ãƒƒã‚¯é…ç½®å¯èƒ½ãªçµæœã®ã¿è¡¨ç¤ºï¼‰';
            } else if (filterNoAsterisk) {
                filterMessage = 'ï¼ˆã€Œ*ã€ãªã—ã®çµæœã®ã¿è¡¨ç¤ºï¼‰';
            }
            
            countDiv.textContent = `${filteredResults.length}å€‹ã®çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ${filterMessage} / ${filteredResults.length} results found`;
            resultsDiv.appendChild(countDiv);
            
            // çµæœãŒ0ä»¶ã®å ´åˆ
            if (filteredResults.length === 0) {
                const noResultDiv = document.createElement('div');
                noResultDiv.className = 'result-item';
                noResultDiv.textContent = 'æ¡ä»¶ã‚’æº€ãŸã™çµæœãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸ / Not found';
                resultsDiv.appendChild(noResultDiv);
                return;
            }
            
            // çµæœè¡¨ç¤º
            filteredResults.slice(0, dispMAX).forEach((r, idx) => {
                displayResultItem(r, idx, showInternal, resultsDiv);
            });
        }
        
        function displayResultItem(r, idx, showInternal, resultsDiv) {
            const a = r[0], b = r[1], c = r[2], d = r[3], e = r[4], f = r[5], g = r[7], cut = r[9];
            
            const resultItem = document.createElement('div');
            resultItem.className = 'result-item';
            
            // åˆ‡ã‚Šæ¨ã¦å€¤ãŒ0.7225ä»¥ä¸Šã®å ´åˆã‚¢ã‚¹ã‚¿ãƒªã‚¹ã‚¯è¡¨ç¤º
            const asterisk = cut >= 0.7225 ? '*' : '';
            
            // æ¥½å™¨ãƒ–ãƒ­ãƒƒã‚¯é…ç½®å¯èƒ½ãƒãƒ¼ã‚¯
            const musicBlockMark = ((g === 2 && b === 0 && c === 0 && d === 0 && e === 0 && f === 0) || 
                                 (a >= 2 && g >= 1)) ? ' ğŸµ' : '';
            
            // è¨ˆç®—å€¤
            const groundA = a;
            const groundG = g/2;
            const groundGDisplay = groundG === Math.floor(groundG) ? groundG : groundG.toFixed(1);
            
            const steepB = b;
            const steepD = d/2;
            const steepDDisplay = steepD === Math.floor(steepD) ? steepD : steepD.toFixed(1);
            
            const gentleC = c;
            const gentleEF = e/4 + 3*f/4;
            const gentleEFDisplay = gentleEF === Math.floor(gentleEF) ? gentleEF : gentleEF.toFixed(2);
            
            let resultHTML = `
                <strong>çµæœ Result ${idx + 1}${asterisk}${musicBlockMark}</strong><br>
                åœ°é¢ (Ground): ${groundA} + ${groundGDisplay}<br>
                æ€¥ãªå‚ (Steep Slope): ${steepB} + ${steepDDisplay}<br>
                ç·©ã‚„ã‹ãªå‚ (Gentle Slope): ${gentleC} + ${gentleEFDisplay}
            `;
            
            // å†…éƒ¨å€¤è¡¨ç¤º
            if (showInternal) {
                resultHTML += `
                <div class="internal-values">
                    ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿: a=${a}, b=${b}, c=${c}, d=${d}, e=${e}, f=${f}, g=${g}<br>
                    åˆ‡ã‚Šæ¨ã¦å€¤ (Cut value): ${cut.toFixed(4)}
                </div>`;
            }
            
            resultItem.innerHTML = resultHTML;
            resultsDiv.appendChild(resultItem);
        }
    </script>
</body>
</html>
